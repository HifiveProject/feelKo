<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- css -->
    <link rel="stylesheet" href="/css/template/template.css">
    <link rel="stylesheet" href="/css/common/header.css">
    <link rel="stylesheet" href="/css/common/main.css">
    <link rel="stylesheet" href="/css/common/footer.css">
    <link rel="stylesheet" href="/css/experience/detail.css">
    <link rel="stylesheet" th:href="@{/css/experience/style.css}" type="text/css">


    <title>Feelko-template3</title>

    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <!-- fontAwesome -->
    <script src="https://kit.fontawesome.com/ae1a88d4e2.js" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
            integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer">
    </script>
</head>

<body class="template--body">

<!-- Template-header 시작 -->
<th:block th:replace="domain/layout/header"> </th:block>
<!-- Template-header 끝 -->

<!-- Template-main 시작 -->
<main class="template--main">
    <aside class="template--leftAside"></aside>
    <section class="template--Section">

        <!-- 콘텐츠 시작 -->
        <div class="template--contentContainer2">
            <div class="template--contentBox2">
                <!-- 두 번째 HTML 코드 삽입 -->
                <div class="card">
                    <div class="container">
                        <h4 th:text="'제목: ' + ${experience.title}"></h4>
                        <img th:src="${experience.imageUrl}" alt="Image">
                        <p th:text="'지역: ' + ${experience.location}"></p>
                        <p th:text="'설명: ' + ${experience.descriptionText}"></p>
                        <p th:text="'시작 날짜: ' + ${experience.startDate}"></p>
                        <p th:text="'종료 날짜: ' + ${experience.endDate}"></p>
                        <p th:text="${experience.experienceClose} ? '상태: 마감' : '상태: 운영중'"></p>
                        <p th:text="'남은 인원수: ' + ${experience.headcount}"></p>
                        <p th:text="'가격 : ' + ${#numbers.formatInteger(experience.price, 1, 'COMMA')} + ' 원'"></p>
                        <div th:if="${isLogined}">

                            <form th:action="@{|/answer/create/${experienceId}|}" method="post">
                                <label for="content">댓글</label>
                                <textarea name="content" id="content" rows="5"></textarea>
                                <input type="submit" value="댓글입력">
                            </form>
                            <ul>
                                <li th:each="answer : ${experience.getAnswers()}">
                                    <span th:text="${experience.getId()}"></span>: <span th:text="${answer.getContent()}"></span>
                                </li>
                            </ul>
                            <button type="button" id="wishBtn" th:onclick="'saveWish()'" th:class="${isWished} ? 'btn-wished' : ''">
                                <span th:if="${isWished}">찜 해제</span>
                                <span th:if="${!isWished}">찜 등록</span>
                            </button>
                        </div>
                        <div th:if="${!isLogined}" style="display: flex; flex-direction: column;">
                            <button type="button" onclick="window.location.href='/member/login'">
                                로그인 후 댓글 사용
                            </button>
                            <button type="button" onclick="window.location.href='/member/login'">
                                로그인 후 찜 가능
                            </button>
                        </div>
                    </div>
                </div>

                <script>
                    var selectedDestination = "";
                    function getSelectedDestination() {
                        var destinationSelect = document.getElementById('destination');
                        selectedDestination = destinationSelect.value;
                    }
                </script>

                <div class="template--pageTitleContainer2">
                    <div class="template--pageTitleBox">
                        <div class="template--overlayedTitle2" style="color: #2f2c2c;">
                            <a>
                                <form action="/search" method="get">
                                    <label for="destination">인원수 :</label>
                                    <select id="destination" name="destination" required onchange="getSelectedDestination()">
                                        <option value="" disabled selected hidden>인원수를 선택하세요</option>
                                        <option name="count">1</option>
                                        <option name="count">2</option>
                                        <option name="count">3</option>
                                        <option name="count">4</option>
                                        <option name="count">5</option>
                                        <option name="count">6</option>
                                        <option name="count">7</option>
                                        <option name="count">8</option>
                                        <option name="count">9</option>
                                        <option name="count">10</option>
                                        <option></option>
                                    </select>
                                    <label for="start_date">날짜 :</label>
                                    <input type="date" id="start_date" name="start_date">
                                </form>

                            </a>
                        </div>
                    </div>
                </div>
                <button th:onclick="'deleteProduct(' + ${experience.getId()} + ')'" > 결제 하기 </button>
            </div>
        </div>
        <!-- 콘텐츠 끝 -->

    </section>
    <aside class="template--rightAside"></aside>
</main>
<!-- Template-main 끝 -->

<!-- Template-footer 시작 -->
<th:block th:replace="domain/layout/footer"> </th:block>
<!-- Template-footer 끝 -->

<script th:inline="javascript" type="text/javascript">
    const deleteProduct = (id) => {
        // 여행지 선택 값 가져오기
        var destinationSelect = document.getElementById('destination');
        var selectedDestination = destinationSelect.value;

        // 날짜 값 가져오기
        var startDateInput = document.getElementById('start_date');
        var selectedStartDate = startDateInput.value;

        // 가져온 값을 콘솔에 출력 또는 다른 작업 수행
        console.log("Selected Destination: " + selectedDestination);
        console.log("Selected Start Date: " + selectedStartDate);

        // 이후 작업 수행...
        window.location.href = "/payment/" + id + "/" + selectedDestination + "/" + selectedStartDate;
    }
</script>

<!-- bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
<!-- js -->
<script src="/js/common/header.js"></script>
<script src="/js/common/main.js"></script>
<script src="/js/common/footer.js"></script>

<!-- 찜 관련 script -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script th:inline="javascript">
    /** 위시리스트에 추가 **/
    function saveWish() {
        var experienceId = [[${experience.id}]];

        $.ajax({
            url: '/member/mypage/wishlist',
            type: 'POST',
            data : {
                experienceId: experienceId
            }
        }).done(function(result){
            if(result){
                alert("찜이 등록되었습니다.");
                $('#wishBtn').html('찜 해제');
                $('#wishBtn').addClass('btn-wished');
            } else {
                alert("찜이 삭제되었습니다.");
                $('#wishBtn').html('찜 등록');
                $('#wishBtn').removeClass('btn-wished');
            }
        }).fail(function(error){
            alert("요청에 실패하였습니다.\n로그인 상태인지 확인 해주세요.");
        });
    };
</script>

</body>
</html>
